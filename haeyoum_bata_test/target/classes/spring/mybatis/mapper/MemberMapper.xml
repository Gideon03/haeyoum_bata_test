<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="member.model.MemberMapper">

<!--  Member -->
	<!-- check email -->
	<select id="chkEmail" resultType="int">
		select count(*) 
		from member 
		where m_email = #{m_email}
	</select>

	<!-- sign up -->
	<insert id="insertUser" parameterType="member">
		insert into member 
		values (#{m_email}, #{m_password}, #{m_name}, #{m_authkey}, 1, 0)
	</insert>
	
	<!-- search authkey user -->
	<select id="chkAuthkey" resultType="member">
		select * from member 
		where m_authkey = #{m_authkey}
	</select>
	
	<!-- user activate -->
	<update id="keyConfirm" parameterType="member">
		update member 
		set m_authkey = 0 
		where m_email = #{m_email}
	</update>
		
	<!-- sign in -->
	<select id="selectByUser" resultType="member">
		select *
		from member 
		where m_email = #{m_email}
	</select>
	
<!-- Member Info -->
	<!-- create info -->
	<insert id="insertInfo" parameterType="memberInfo">
		insert into member_info
		values (#{m_email}, #{m_image}, #{m_phone})
	</insert>
	
	<!-- select Info -->
	<select id="selectInfo" resultType="memberInfo">
		select * from member_info
		where m_email = #{m_email}
	</select>
	
	<update id="editInfo" parameterType="memberInfo">
		update member_info
		set m_image = #{m_image}, 
			m_phone = #{m_phone}
		where m_email = #{m_email}
	</update>
	
<!-- Member Log -->
	<!-- create Log -->
	<insert id="insertLog">
		insert into member_log
		values (#{m_email}, now())
	</insert>
	
	<!-- select Log -->
	<select id="selectLog" resultType="memberLog">
		select * from member_log
		where m_email = #{m_email}
	</select>
	
	<!-- update Log -->
	<update id="updateLog">
		update member_log
		set m_recent_date = now()
		where m_email = #{m_email}
	</update>
	
</mapper>